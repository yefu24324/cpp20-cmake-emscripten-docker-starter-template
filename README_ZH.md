C++20 CMake-Emscripten æ¨¡æ¿
===============================

*ä¸º**C++20**æºä»£ç è®¾ç½®**åŸç”Ÿ**å’Œ**Web**æ„å»ºç¯å¢ƒã€‚*

ğŸ¤” ä¸ºä»€ä¹ˆåˆ›å»ºè¿™ä¸ªä»“åº“ï¼Ÿ
-----------------------

**é—®é¢˜ï¼š** ç›®å‰åœ¨ä½¿ç”¨C++20ä¸Emscriptençš„`emcmake`æ—¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼ˆ[emscripten#22305](https://github.com/emscripten-core/emscripten/issues/22305)ï¼‰ã€‚æœ‰ä¸€ä¸ªä¿®å¤æ–¹æ¡ˆåœ¨[PR#21987](https://github.com/emscripten-core/emscripten/pull/21987)ä¸­æå‡ºï¼Œä½†å°šæœªåˆå¹¶ã€‚

**è§£å†³æ–¹æ¡ˆï¼š** æœ¬ä»“åº“æä¾›äº†ä¸€ä¸ªæœ€å°åŒ–è®¾ç½®ï¼Œ**å¯¼å…¥äº†**[PR#21987](https://github.com/emscripten-core/emscripten/pull/21987)ä¸­æå‡ºçš„ä¿®å¤æ–¹æ¡ˆï¼Œ**æ— éœ€ä¿®æ”¹emscripten**æœ¬èº«ã€‚

**å¢å¼ºåŠŸèƒ½ï¼š** åœ¨åŸå§‹é¡¹ç›®åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ·»åŠ äº†Dockeræ”¯æŒï¼Œä½¿å¼€å‘è€…å¯ä»¥é€šè¿‡ç®€å•çš„Dockerå‘½ä»¤å¿«é€Ÿæ„å»ºé¡¹ç›®ï¼Œæ— éœ€ç¹ççš„ç¯å¢ƒé…ç½®ã€‚æ­¤å¤–ï¼Œè¿˜å¢åŠ äº†ä¸€äº›ç¤ºä¾‹å‡½æ•°ï¼Œå¸®åŠ©æ–°æ‰‹æ›´å¿«åœ°ç†è§£å’Œå­¦ä¹ C++20ä¸WebAssemblyçš„ç»“åˆä½¿ç”¨ã€‚

ğŸ¥¸ ä½œä¸ºæ¨¡æ¿ä½¿ç”¨
---------------------

æ‚¨å¯ä»¥å°†æ­¤ä»“åº“ç”¨ä½œæ¨¡æ¿ï¼Œç„¶ååœ¨ä»£ç åº“ä¸­æ›¿æ¢ä»¥ä¸‹å­—ç¬¦ä¸²ï¼š

 - `my_project`æ˜¯CMakeé¡¹ç›®ï¼ˆå’ŒIDEè§£å†³æ–¹æ¡ˆï¼‰çš„åç§°ã€‚
 - `my_target`æ˜¯CMakeç›®æ ‡çš„åç§°ï¼Œå³ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶æˆ–HTMLæ–‡ä»¶çš„åç§°ã€‚

ğŸ—ï¸ æ„å»º
-----------

è¿™æ˜¯ä¸€ä¸ªå¸¸è§„çš„CMakeé¡¹ç›®ï¼Œæ„å»ºæ–¹å¼ä¸æ™®é€šCMakeé¡¹ç›®ç›¸åŒã€‚**å”¯ä¸€çš„ä¾‹å¤–**æ˜¯Webæ„å»ºéœ€è¦é¢å¤–çš„é€‰é¡¹ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚

ä»¥ä¸‹æŒ‡ä»¤å±•ç¤ºäº†å¦‚ä½•æ‰‹åŠ¨è°ƒç”¨CMakeï¼Œä½†ä¹Ÿæä¾›äº†`CMakePresets.json`æ–‡ä»¶ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆã€‚

### ä½¿ç”¨Dockeræ„å»ºï¼ˆæ¨èï¼‰

æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨Dockerï¼Œæ— éœ€å®‰è£…ä»»ä½•ä¾èµ–é¡¹ï¼š

```bash
# ä¸€é”®æ„å»ºé¡¹ç›®å¹¶ç”ŸæˆJavaScript/WebAssemblyæ–‡ä»¶
docker compose up --remove-orphans
```

è¿™æ¡å‘½ä»¤ä¼šè‡ªåŠ¨è®¾ç½®æ‰€æœ‰å¿…è¦çš„ç¯å¢ƒï¼Œå¹¶ä½¿ç”¨Emscriptenç¼–è¯‘é¡¹ç›®ï¼Œè¾“å‡ºå¯ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„æ–‡ä»¶ã€‚

### åŸç”Ÿæ„å»º

```bash
# é…ç½®
cmake -B build-native
# æˆ–ä½¿ç”¨ 'cmake --preset native'

# æ„å»º
cmake --build build-native

# è¿è¡Œ (Windows & MSVC)
build/src/Debug/my_target.exe

# è¿è¡Œ (å…¶ä»–ç³»ç»Ÿ)
build/src/my_target
```

### WebAssemblyæ„å»º

**æ³¨æ„** *é’ˆå¯¹é—®é¢˜[emscripten#22305](https://github.com/emscripten-core/emscripten/issues/22305)çš„è§£å†³æ–¹æ³•æ˜¯å°†`CMAKE_CXX_COMPILER_CLANG_SCAN_DEPS`æŒ‡å‘æˆ‘ä»¬åœ¨`cmake/EmscriptenScanDepsFix`ä¸­çš„æœ¬åœ°ä¿®å¤ã€‚*

```bash
# æ¿€æ´»emscriptenç¯å¢ƒ (Windows)
C:/path/to/emsdk/emsdk_env.bat

# æ¿€æ´»emscriptenç¯å¢ƒ (å…¶ä»–ç³»ç»Ÿ)
. /path/to/emsdk/emsdk_env.sh

# é…ç½®
emcmake cmake -B build -DCMAKE_CXX_COMPILER_CLANG_SCAN_DEPS=cmake/EmscriptenScanDepsFix/emscan-deps
# æˆ–ä½¿ç”¨ 'emcmake cmake --preset web'

# æ„å»º
cmake --build build

# æ‰˜ç®¡
python -m http.server 8000
# ç„¶åæµè§ˆå™¨è®¿é—® http://localhost:8000/build-web/src/my_target.html
```

ğŸ“š ç¤ºä¾‹å‡½æ•°
-----------

ä¸ºäº†å¸®åŠ©æ–°æ‰‹å¿«é€Ÿä¸Šæ‰‹ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æ·»åŠ äº†å‡ ä¸ªç¤ºä¾‹å‡½æ•°ï¼Œå±•ç¤ºäº†C++20ä¸WebAssemblyçš„äº¤äº’æ–¹å¼ï¼š

- JavaScript/C++æ•°æ®ä¼ é€’ç¤ºä¾‹
- C++20æ–°ç‰¹æ€§åœ¨WebAssemblyä¸­çš„åº”ç”¨
- DOMæ“ä½œç¤ºä¾‹
- å¼‚æ­¥å‡½æ•°è°ƒç”¨ç¤ºä¾‹

è¿™äº›ç¤ºä¾‹å‡½æ•°é…æœ‰è¯¦ç»†æ³¨é‡Šï¼Œå¯ä»¥ä½œä¸ºå¼€å‘è€…å­¦ä¹ å’Œå®è·µçš„å‚è€ƒã€‚ 